<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Happy Birthday Mahie ğŸ‚</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@import url('https://fonts.googleapis.com/css?family=Lato:300italic');

* { box-sizing: border-box; }

html, body {
  width: 100%;
  height: 100%;
  margin: 0;
}

body {
  background: #ee9ca7;
  font-family: 'Lato', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
}

.hidden { display: none; }

/* ğŸ BOX */
#box {
  cursor: pointer;
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  50% { transform: scale(1.1); }
}
.box-lid {
  width: 140px;
  height: 35px;
  background: #ff4757;
  border-radius: 8px;
  margin: auto;
}
.box-body {
  width: 130px;
  height: 110px;
  background: #ff6b81;
  border-radius: 0 0 12px 12px;
  margin: auto;
}

/* BUTTON */
button {
  padding: 14px 28px;
  font-size: 17px;
  border: none;
  border-radius: 40px;
  background: #6a2a32;
  color: white;
  cursor: pointer;
  margin-top: 20px;
}

/* ğŸˆ BALLOONS */
#balloons {
  font-size: 36px;
  margin-bottom: 10px;
  animation: float 2s infinite alternate;
}
@keyframes float {
  to { transform: translateY(-15px); }
}

/* ğŸ‚ CAKE */
#cake-area {
  margin-top: 20px;
}

.candle {
  width: 6px;
  height: 36px;
  background: white;
  margin: auto;
  position: relative;
  border-radius: 4px;
}

.flame {
  position: absolute;
  top: -20px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 20px;
  background: rgba(255,200,0,0.9);
  border-radius: 50%;
  animation: flicker 0.25s infinite;
}
.flame.off {
  opacity: 0;
  animation: none;
}
@keyframes flicker {
  50% { transform: translateX(-50%) scale(0.75); }
}

.text {
  color: #8b6a60;
  font-style: italic;
  margin-top: 15px;
}

#instruction {
  color: #6a2a32;
  font-weight: bold;
  margin-top: 10px;
}
</style>
</head>

<body>

<!-- ğŸ BOX -->
<div id="box">
  <div class="box-lid"></div>
  <div class="box-body"></div>
  <p>Click to open ğŸ</p>
</div>

<button id="decorateBtn" class="hidden">Decorate the cake ğŸ¨</button>

<!-- ğŸ‚ CAKE SECTION -->
<div id="cake-area" class="hidden">

  <div id="balloons">ğŸˆ ğŸˆ ğŸˆ ğŸ‰ ğŸˆ ğŸˆ</div>

  <div class="candle">
    <div class="flame" id="flame"></div>
  </div>

  <!-- CAKE IMAGE (VISIBLE & RELIABLE) -->
  <img
    src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Birthday_cake.svg/512px-Birthday_cake.svg.png"
    width="180"
    alt="Birthday Cake"
  >

  <div class="text">
    <h1>happy birthday!</h1>
    <p style="font-size:1.6rem;font-weight:bold;">Mahie</p>
  </div>

  <p id="instruction">ğŸŒ¬ Blow the candle or wait 12 seconds</p>
</div>

<!-- ğŸµ LOCAL AUDIO -->
<audio id="song" src="birthday.mp3"></audio>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const box = document.getElementById("box");
  const decorateBtn = document.getElementById("decorateBtn");
  const cakeArea = document.getElementById("cake-area");
  const flame = document.getElementById("flame");
  const song = document.getElementById("song");
  const instruction = document.getElementById("instruction");

  let blown = false;

  // Open box
  box.onclick = () => {
    box.classList.add("hidden");
    decorateBtn.classList.remove("hidden");
  };

  // Decorate & start everything
  decorateBtn.onclick = async () => {
    decorateBtn.classList.add("hidden");
    cakeArea.classList.remove("hidden");

    // Play music (20s)
    song.currentTime = 0;
    song.play();
    setTimeout(() => song.pause(), 20000);

    // Auto candle off after 12s
    setTimeout(blowOut, 12000);

    // Mic detection
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      await ctx.resume();

      const mic = ctx.createMediaStreamSource(stream);
      const analyser = ctx.createAnalyser();
      mic.connect(analyser);

      const data = new Uint8Array(analyser.frequencyBinCount);

      function listen() {
        if (blown) return;
        analyser.getByteTimeDomainData(data);

        let sum = 0;
        for (let i of data) {
          let v = (i - 128) / 128;
          sum += v * v;
        }

        if (Math.sqrt(sum / data.length) > 0.08) {
          blowOut();
          stream.getTracks().forEach(t => t.stop());
        }
        requestAnimationFrame(listen);
      }
      listen();
    } catch {
      console.log("Mic denied â€“ auto off will work");
    }
  };

  function blowOut() {
    if (blown) return;
    blown = true;
    flame.classList.add("off");
    instruction.innerHTML = "âœ¨ Wish made! Happy Birthday Mahie âœ¨";
  }

});
</script>

</body>
</html>
